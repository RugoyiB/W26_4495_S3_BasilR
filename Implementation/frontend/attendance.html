<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance</title>
  <script src="frontend/authGuard.js"></script>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>

<nav class="navbar">
  <h2>Church Admin</h2>
  <ul>
    <li><a href="dashboard.html">Dashboard</a></li>
    <li><a href="attendance.html">Attendance</a></li>
    <li><a href="attendance-report.html">Attendance Report</a></li>
  </ul>
</nav>

<div class="form-container">
  <h2>Mark Attendance</h2>

  <select id="member">
    <option value="">Select Member</option>
  </select>

  <input type="date" id="date">

  <select id="status">
    <option value="Present">Present</option>
    <option value="Absent">Absent</option>
  </select>

  <button onclick="markAttendance()">Save Attendance</button>
  <p id="message"></p>
</div>

<script>
  const MEMBERS_API = "http://localhost:5000/api/members";
  const ATTENDANCE_API = "http://localhost:5000/api/attendance";

  // Load members
  async function loadMembers() {
    const res = await fetch(MEMBERS_API);
    const members = await res.json();

    const select = document.getElementById("member");
    members.forEach(m => {
      const option = document.createElement("option");
      option.value = m._id;
      option.textContent = `${m.firstName} ${m.lastName}`;
      select.appendChild(option);
    });
  }

  // Save attendance
  async function markAttendance() {
    const data = {
      member: document.getElementById("member").value,
      date: document.getElementById("date").value,
      status: document.getElementById("status").value
    };

    const res = await fetch(ATTENDANCE_API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    document.getElementById("message").innerText =
      res.ok ? "Attendance saved successfully" : "Error saving attendance";
  }

  loadMembers();
</script>

</body>
</html>
